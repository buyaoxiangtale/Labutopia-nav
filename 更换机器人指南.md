# æ›´æ¢æœºå™¨äººæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

`ridgeback_franka.usd` æ˜¯é¡¹ç›®ä¸­ä½¿ç”¨çš„ç§»åŠ¨æœºå™¨äººæ¨¡å‹ã€‚æœ¬æŒ‡å—è¯´æ˜å®ƒåœ¨å“ªé‡Œè¢«ä½¿ç”¨ä»¥åŠå¦‚ä½•æ›´æ¢ä¸ºå…¶ä»–æœºå™¨äººã€‚

---

## ğŸ” å½“å‰ä½¿ç”¨ä½ç½®

### ç›´æ¥ä½¿ç”¨çš„æ–‡ä»¶ï¼ˆ4ä¸ªï¼‰

1. **`demo_ridgebase_astar_nav.py`** - å¯¼èˆªæ¼”ç¤º
   ```python
   usd_path="assets/robots/ridgeback_franka.usd"
   ```

2. **`demo_manual_pick.py`** - æ‰‹åŠ¨æ‹¾å–æ¼”ç¤º
   ```python
   usd_path="assets/robots/ridgeback_franka.usd"
   ```

3. **`demo_replay_pick.py`** - æ•°æ®å›æ”¾æ¼”ç¤º
   ```python
   usd_path="assets/robots/ridgeback_franka.usd"
   ```

4. **`demo_inference_pick.py`** - æ¨¡å‹æ¨ç†æ¼”ç¤º
   ```python
   usd_path="assets/robots/ridgeback_franka.usd"
   ```

### æœºå™¨äººé…ç½®ç›¸å…³

- **`factories/robot_factory.py`** - æœºå™¨äººå·¥å‚ï¼ˆç”¨äºä¸»ç¨‹åºï¼‰
- **`robots/franka.py`** - Franka æœºå™¨äººå°è£…ç±»

---

## ğŸ¤– é¡¹ç›®ä¸­å¯ç”¨çš„æœºå™¨äºº

æŸ¥çœ‹ `assets/robots/` ç›®å½•ï¼š

```
assets/robots/
â”œâ”€â”€ ridgeback_franka.usd  # å½“å‰ä½¿ç”¨çš„ç§»åŠ¨æœºå™¨äººï¼ˆRidgeback åº•ç›˜ + Franka æœºæ¢°è‡‚ï¼‰
â””â”€â”€ Franka.usd            # å•ç‹¬çš„ Franka æœºæ¢°è‡‚
```

---

## ğŸ”„ æ›´æ¢æœºå™¨äººçš„æ–¹æ³•

### æ–¹æ³• 1ï¼šç›´æ¥ä¿®æ”¹ USD è·¯å¾„ï¼ˆæœ€ç®€å•ï¼‰

åœ¨æ‰€æœ‰ä½¿ç”¨ `ridgeback_franka.usd` çš„æ–‡ä»¶ä¸­ï¼Œå°†è·¯å¾„æ”¹ä¸ºæ–°æœºå™¨äººï¼š

**ä¿®æ”¹å‰ï¼š**
```python
add_reference_to_stage(
    usd_path="assets/robots/ridgeback_franka.usd",
    prim_path=robot_path
)
```

**ä¿®æ”¹åï¼š**
```python
add_reference_to_stage(
    usd_path="assets/robots/your_new_robot.usd",  # æ–°æœºå™¨äººè·¯å¾„
    prim_path=robot_path
)
```

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼š**
- `demo_ridgebase_astar_nav.py` (ç¬¬ 73 è¡Œ)
- `demo_manual_pick.py` (ç¬¬ 103 è¡Œ)
- `demo_replay_pick.py` (ç¬¬ 50 è¡Œ)
- `demo_inference_pick.py` (ç¬¬ 84 è¡Œ)

### æ–¹æ³• 2ï¼šä½¿ç”¨é…ç½®å˜é‡ï¼ˆæ¨èï¼‰

åˆ›å»ºä¸€ä¸ªé…ç½®å˜é‡ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†ï¼š

**æ­¥éª¤ 1ï¼šåœ¨æ–‡ä»¶é¡¶éƒ¨å®šä¹‰é…ç½®**

```python
# æœºå™¨äººé…ç½®
ROBOT_USD_PATH = "assets/robots/your_new_robot.usd"
ROBOT_PRIM_PATH = "/World/YourRobot"  # æ ¹æ®æ–°æœºå™¨äººè°ƒæ•´
ROBOT_NAME = "your_robot"
```

**æ­¥éª¤ 2ï¼šä½¿ç”¨é…ç½®å˜é‡**

```python
add_reference_to_stage(
    usd_path=ROBOT_USD_PATH,
    prim_path=ROBOT_PRIM_PATH
)

robot = Robot(
    prim_path=ROBOT_PRIM_PATH,
    name=ROBOT_NAME,
    position=np.array([0.0, 0.0, 0.0])
)
```

### æ–¹æ³• 3ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶ï¼ˆæœ€çµæ´»ï¼‰

åˆ›å»ºä¸€ä¸ªæœºå™¨äººé…ç½®æ–‡ä»¶ï¼š

**åˆ›å»º `config/robots.yaml`ï¼š**
```yaml
robots:
  ridgeback_franka:
    usd_path: "assets/robots/ridgeback_franka.usd"
    prim_path: "/World/Ridgebase"
    name: "ridgebase"
    
  your_robot:
    usd_path: "assets/robots/your_new_robot.usd"
    prim_path: "/World/YourRobot"
    name: "your_robot"
```

**åœ¨ä»£ç ä¸­ä½¿ç”¨ï¼š**
```python
import yaml

def load_robot_config(config_path="config/robots.yaml", robot_type="ridgeback_franka"):
    with open(config_path, 'r') as f:
        config = yaml.safe_load(f)
    return config['robots'][robot_type]

# ä½¿ç”¨
robot_config = load_robot_config(robot_type="your_robot")
add_reference_to_stage(
    usd_path=robot_config['usd_path'],
    prim_path=robot_config['prim_path']
)
```

---

## âš ï¸ æ›´æ¢æœºå™¨äººéœ€è¦æ³¨æ„çš„äº‹é¡¹

### 1. Prim è·¯å¾„

ä¸åŒæœºå™¨äººçš„ USD æ–‡ä»¶ä¸­ï¼Œprim è·¯å¾„å¯èƒ½ä¸åŒï¼š

**å½“å‰ï¼š**
```python
robot_path = "/World/Ridgebase"
```

**æ–°æœºå™¨äººå¯èƒ½éœ€è¦ï¼š**
```python
robot_path = "/World/YourRobot"  # æ ¹æ®å®é™… USD æ–‡ä»¶è°ƒæ•´
```

**å¦‚ä½•æŸ¥çœ‹ USD æ–‡ä»¶ä¸­çš„ prim è·¯å¾„ï¼Ÿ**
- åœ¨ Isaac Sim ä¸­æ‰“å¼€ USD æ–‡ä»¶
- æŸ¥çœ‹ Outlinerï¼ˆå¤§çº²è§†å›¾ï¼‰
- æ‰¾åˆ°æœºå™¨äººçš„æ ¹ prim è·¯å¾„

### 2. æ§åˆ¶å™¨å…¼å®¹æ€§

å½“å‰ä»£ç ä½¿ç”¨ `RidgebaseController`ï¼Œå¦‚æœæ›´æ¢æœºå™¨äººï¼Œå¯èƒ½éœ€è¦ï¼š

- **ç§»åŠ¨æœºå™¨äºº**ï¼šä½¿ç”¨ `RidgebaseController` æˆ–ç±»ä¼¼çš„ç§»åŠ¨æ§åˆ¶å™¨
- **æœºæ¢°è‡‚æœºå™¨äºº**ï¼šä½¿ç”¨ `FrankaTrajectoryController` æˆ–å…¶ä»–æœºæ¢°è‡‚æ§åˆ¶å™¨
- **éœ€è¦ä¿®æ”¹æ§åˆ¶å™¨ä»£ç **

**ç¤ºä¾‹ï¼š**

```python
# å¯¹äºç§»åŠ¨æœºå™¨äºº
from controllers.robot_controllers.ridgebase.ridgebase_controller import RidgebaseController
controller = RidgebaseController(
    robot_articulation=robot,
    max_linear_speed=0.02,
    max_angular_speed=1.5,
    ...
)

# å¯¹äºæœºæ¢°è‡‚æœºå™¨äºº
from controllers.robot_controllers.trajectory_controller import FrankaTrajectoryController
controller = FrankaTrajectoryController(
    name="robot_controller",
    robot_articulation=robot
)
```

### 3. å…³èŠ‚åç§°

`RidgebaseController` ä½¿ç”¨ç‰¹å®šçš„å…³èŠ‚åç§°ï¼š

```python
["dummy_base_prismatic_x_joint", "dummy_base_prismatic_y_joint", "dummy_base_revolute_z_joint"]
```

å¦‚æœæ–°æœºå™¨äººä½¿ç”¨ä¸åŒçš„å…³èŠ‚åç§°ï¼Œéœ€è¦ï¼š
- ä¿®æ”¹ `RidgebaseController` çš„å…³èŠ‚é…ç½®
- æˆ–åˆ›å»ºæ–°çš„æ§åˆ¶å™¨ç±»

### 4. ç›¸æœºä½ç½®

å¦‚æœä»£ç ä¸­ä½¿ç”¨ç›¸æœºï¼Œå¯èƒ½éœ€è¦è°ƒæ•´ç›¸æœºè·¯å¾„ï¼š

**å½“å‰ï¼š**
```python
"/World/Ridgebase/base_link/Camera_01"
"/World/Ridgebase/base_link/Camera"
"/World/Ridgebase/panda_hand/Camera"
```

**æ–°æœºå™¨äººå¯èƒ½éœ€è¦ï¼š**
```python
"/World/YourRobot/camera_link/Camera"  # æ ¹æ®å®é™…ç»“æ„è°ƒæ•´
```

### 5. åˆå§‹ä½ç½®å’Œå§¿æ€

ç¡®ä¿æœºå™¨äººåˆå§‹ä½ç½®åˆé€‚ï¼š

```python
robot = Robot(
    prim_path=robot_path,
    name="robot_name",
    position=np.array([0.0, 0.0, 0.0]),  # å¯èƒ½éœ€è¦è°ƒæ•´ Z é«˜åº¦
    # orientation=...  # å¯èƒ½éœ€è¦è®¾ç½®åˆå§‹æœå‘
)
```

---

## ğŸ“ å®Œæ•´æ›´æ¢ç¤ºä¾‹

### ç¤ºä¾‹ï¼šæ›´æ¢ä¸ºæ–°çš„ç§»åŠ¨æœºå™¨äºº

å‡è®¾ä½ æœ‰ä¸€ä¸ªæ–°çš„ç§»åŠ¨æœºå™¨äºº `my_robot.usd`ï¼Œä»¥ä¸‹æ˜¯å®Œæ•´æ­¥éª¤ï¼š

**æ­¥éª¤ 1ï¼šå‡†å¤‡æœºå™¨äººæ–‡ä»¶**

```bash
# å°†æ–°æœºå™¨äºº USD æ–‡ä»¶æ”¾åˆ° assets/robots/ ç›®å½•
cp /path/to/my_robot.usd assets/robots/my_robot.usd
```

**æ­¥éª¤ 2ï¼šä¿®æ”¹ä»£ç **

ä¿®æ”¹ `demo_ridgebase_astar_nav.py`ï¼š

```python
# åŸæ¥çš„ä»£ç 
robot_path = "/World/Ridgebase"
add_reference_to_stage(
    usd_path="assets/robots/ridgeback_franka.usd",
    prim_path=robot_path
)

# ä¿®æ”¹ä¸º
robot_path = "/World/MyRobot"  # æ ¹æ® USD æ–‡ä»¶ä¸­çš„å®é™…è·¯å¾„
add_reference_to_stage(
    usd_path="assets/robots/my_robot.usd",
    prim_path=robot_path
)
```

**æ­¥éª¤ 3ï¼šæ£€æŸ¥æ§åˆ¶å™¨**

å¦‚æœæ–°æœºå™¨äººä½¿ç”¨ç›¸åŒçš„å…³èŠ‚ç»“æ„ï¼Œæ§åˆ¶å™¨å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚å¦åˆ™éœ€è¦ä¿®æ”¹æˆ–åˆ›å»ºæ–°æ§åˆ¶å™¨ã€‚

**æ­¥éª¤ 4ï¼šæµ‹è¯•**

è¿è¡Œç¨‹åºï¼Œæ£€æŸ¥ï¼š
- æœºå™¨äººæ˜¯å¦æ­£ç¡®åŠ è½½
- æ§åˆ¶å™¨æ˜¯å¦æ­£å¸¸å·¥ä½œ
- ç›¸æœºï¼ˆå¦‚æœæœ‰ï¼‰æ˜¯å¦æ­£ç¡®è®¾ç½®

---

## ğŸ› ï¸ åˆ›å»ºæ–°æœºå™¨äººæ§åˆ¶å™¨

å¦‚æœæ–°æœºå™¨äººéœ€è¦ä¸åŒçš„æ§åˆ¶å™¨ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°ç±»ï¼š

**`controllers/robot_controllers/my_robot/my_robot_controller.py`ï¼š**

```python
import numpy as np
from typing import List, Tuple, Optional
from omni.isaac.core.articulations import Articulation, ArticulationSubset
from omni.isaac.core.utils.types import ArticulationAction

class MyRobotController:
    def __init__(
        self,
        robot_articulation: Articulation,
        max_linear_speed: float = 1.0,
        max_angular_speed: float = 1.0,
        position_threshold: float = 0.1,
        angle_threshold: float = 0.1,
    ):
        self.max_linear_speed = max_linear_speed
        self.max_angular_speed = max_angular_speed
        self.position_threshold = position_threshold
        self.angle_threshold = angle_threshold
        
        # æ ¹æ®æ–°æœºå™¨äººçš„å…³èŠ‚åç§°è°ƒæ•´
        self._joints_subset = ArticulationSubset(
            robot_articulation,
            ["joint_x", "joint_y", "joint_theta"]  # æ–°æœºå™¨äººçš„å…³èŠ‚åç§°
        )
        
        self.waypoints = None
        self.current_waypoint_idx = 0
    
    def set_waypoints(self, waypoints: List[Tuple[float, float, float]]):
        self.waypoints = np.array(waypoints)
        self.current_waypoint_idx = 0
    
    def get_action(self, current_pose: np.ndarray):
        # å®ç°æ§åˆ¶é€»è¾‘
        # ...
        pass
```

---

## ğŸ“‹ æ›´æ¢æ¸…å•

æ›´æ¢æœºå™¨äººæ—¶ï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] USD æ–‡ä»¶è·¯å¾„å·²æ›´æ–°
- [ ] Prim è·¯å¾„å·²æ›´æ–°
- [ ] æœºå™¨äººåç§°å·²æ›´æ–°
- [ ] æ§åˆ¶å™¨å·²é€‚é…ï¼ˆæˆ–å·²åˆ›å»ºæ–°æ§åˆ¶å™¨ï¼‰
- [ ] å…³èŠ‚åç§°å·²æ£€æŸ¥/æ›´æ–°
- [ ] ç›¸æœºè·¯å¾„å·²æ›´æ–°ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
- [ ] åˆå§‹ä½ç½®å·²è°ƒæ•´
- [ ] æ‰€æœ‰ç›¸å…³æ¼”ç¤ºæ–‡ä»¶å·²æ›´æ–°
- [ ] æµ‹è¯•è¿è¡Œæ­£å¸¸

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### æŸ¥çœ‹ USD æ–‡ä»¶ç»“æ„

```bash
# ä½¿ç”¨ Isaac Sim æ‰“å¼€ USD æ–‡ä»¶æŸ¥çœ‹ç»“æ„
# æˆ–åœ¨ä»£ç ä¸­æ‰“å° prim ä¿¡æ¯
```

```python
import omni.usd
stage = omni.usd.get_context().get_stage()
for prim in stage.Traverse():
    print(prim.GetPath())
```

### æŸ¥çœ‹æœºå™¨äººå…³èŠ‚

```python
robot = Robot(prim_path=robot_path, name="robot")
robot.initialize()
for joint_name in robot.dof_names:
    print(joint_name)
```

---

## ğŸ’¡ å»ºè®®

1. **å¤‡ä»½åŸå§‹ä»£ç **ï¼šæ›´æ¢å‰å…ˆå¤‡ä»½
2. **é€æ­¥æµ‹è¯•**ï¼šå…ˆåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­æµ‹è¯•ï¼Œç¡®è®¤æ— è¯¯åå†ä¿®æ”¹å…¶ä»–æ–‡ä»¶
3. **ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶**ï¼šä½¿ç”¨ Git ç®¡ç†æ›´æ”¹
4. **æ–‡æ¡£åŒ–**ï¼šè®°å½•æ–°æœºå™¨äººçš„é…ç½®ä¿¡æ¯

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `controllers/robot_controllers/ridgebase/ridgebase_controller.py` - å½“å‰ä½¿ç”¨çš„æ§åˆ¶å™¨
- `factories/robot_factory.py` - æœºå™¨äººå·¥å‚
- `robots/franka.py` - Franka æœºå™¨äººå°è£…

---

å¸Œæœ›è¿™ä¸ªæŒ‡å—èƒ½å¸®åŠ©ä½ é¡ºåˆ©æ›´æ¢æœºå™¨äººï¼ğŸ‰

