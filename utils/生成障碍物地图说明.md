# ä» USD åœºæ™¯ç”Ÿæˆéšœç¢ç‰©åœ°å›¾

## ğŸ“‹ æ¦‚è¿°

è¿™ä¸ªå·¥å…·å¯ä»¥ä» USD åœºæ™¯æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆéšœç¢ç‰©åœ°å›¾ï¼ˆé»‘ç™½å›¾åƒï¼‰ï¼Œç”¨äºè·¯å¾„è§„åˆ’ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³• 1ï¼šä½¿ç”¨ç¤ºä¾‹è„šæœ¬ï¼ˆæœ€ç®€å•ï¼‰

```bash
python generate_barrier_map_example.py
```

è¿™ä¼šï¼š
1. åŠ è½½ `assets/navigation_lab/navigation_lab_01/lab.usd`
2. ç”Ÿæˆéšœç¢ç‰©åœ°å›¾
3. ä¿å­˜åˆ° `assets/navigation/barrier/lab_1_generated.png`

### æ–¹æ³• 2ï¼šåœ¨ä»£ç ä¸­è°ƒç”¨

```python
from utils.generate_barrier_map_simple import generate_barrier_map_from_usd

# ç”Ÿæˆéšœç¢ç‰©åœ°å›¾
barrier_map = generate_barrier_map_from_usd(
    usd_path="assets/navigation_lab/navigation_lab_01/lab.usd",
    x_bounds=[-7.925, 9.175],
    y_bounds=[-1.525, 4.175],
    resolution=(1024, 512),
    ignore_prims=["/World/Floor", "/World/Robot"],
    output_path="assets/navigation/barrier/lab_1.png"
)
```

### æ–¹æ³• 3ï¼šä»é…ç½®æ–‡ä»¶ç”Ÿæˆ

```python
from utils.generate_barrier_map_simple import load_and_generate_from_config

load_and_generate_from_config("config/navigation/navigation_assets.yaml")
```

## ğŸ“ è¯¦ç»†è¯´æ˜

### å‡½æ•°å‚æ•°

#### `generate_barrier_map_from_usd()`

**å‚æ•°è¯´æ˜**ï¼š

- `usd_path` (str): USD åœºæ™¯æ–‡ä»¶è·¯å¾„
- `x_bounds` (List[float]): X è½´è¾¹ç•Œ `[x_min, x_max]`
- `y_bounds` (List[float]): Y è½´è¾¹ç•Œ `[y_min, y_max]`
- `resolution` (Tuple[int, int]): å›¾åƒåˆ†è¾¨ç‡ `(width, height)`ï¼Œé»˜è®¤ `(1024, 512)`
- `ignore_prims` (Optional[List[str]]): è¦å¿½ç•¥çš„ prim è·¯å¾„åˆ—è¡¨ï¼Œä¾‹å¦‚åœ°æ¿ã€æœºå™¨äººç­‰
- `output_path` (Optional[str]): è¾“å‡ºå›¾åƒè·¯å¾„ï¼ˆPNG æ ¼å¼ï¼‰

**è¿”å›å€¼**ï¼š
- `barrier_map` (np.ndarray): äºŒç»´æ•°ç»„ï¼Œ`1`=éšœç¢ç‰©ï¼Œ`0`=è‡ªç”±ç©ºé—´

### å·¥ä½œåŸç†

1. **éå† USD åœºæ™¯**ï¼šéå†åœºæ™¯ä¸­çš„æ‰€æœ‰å‡ ä½•ä½“ prim
2. **è®¡ç®—åŒ…å›´ç›’**ï¼šè·å–æ¯ä¸ªå‡ ä½•ä½“çš„ä¸–ç•Œç©ºé—´åŒ…å›´ç›’
3. **æŠ•å½±åˆ° XY å¹³é¢**ï¼šå°† 3D åŒ…å›´ç›’æŠ•å½±åˆ° 2D å¹³é¢
4. **ç”Ÿæˆæ …æ ¼åœ°å›¾**ï¼šå°†æŠ•å½±ç»“æœè½¬æ¢ä¸ºåƒç´ åæ ‡ï¼Œæ ‡è®°éšœç¢ç‰©åŒºåŸŸ
5. **ä¿å­˜å›¾åƒ**ï¼šä¿å­˜ä¸ºé»‘ç™½ PNG å›¾åƒ

### å›¾åƒæ ¼å¼

- **ç™½è‰²åƒç´  (255, 255, 255)** = è‡ªç”±ç©ºé—´ï¼Œæœºå™¨äººå¯ä»¥é€šè¡Œ
- **é»‘è‰²åƒç´  (0, 0, 0)** = éšœç¢ç‰©ï¼Œæœºå™¨äººä¸èƒ½é€šè¡Œ

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šåŸºæœ¬ç”¨æ³•

```python
import os
from isaacsim import SimulationApp
simulation_app = SimulationApp({"headless": False})

from omni.isaac.core import World
from omni.isaac.core.utils.stage import add_reference_to_stage
from utils.generate_barrier_map_simple import generate_barrier_map_from_usd

# åˆå§‹åŒ–
world = World(stage_units_in_meters=1.0)

# åŠ è½½åœºæ™¯
usd_path = "assets/navigation_lab/navigation_lab_01/lab.usd"
add_reference_to_stage(usd_path=usd_path, prim_path="/World")
world.reset()

# ç”Ÿæˆéšœç¢ç‰©åœ°å›¾
barrier_map = generate_barrier_map_from_usd(
    usd_path=usd_path,
    x_bounds=[-7.925, 9.175],
    y_bounds=[-1.525, 4.175],
    resolution=(1024, 512),
    ignore_prims=["/World/Floor"],
    output_path="assets/navigation/barrier/lab_1.png"
)

simulation_app.close()
```

### ç¤ºä¾‹ 2ï¼šä»é…ç½®æ–‡ä»¶ç”Ÿæˆ

```python
from utils.generate_barrier_map_simple import load_and_generate_from_config

# ä» navigation_assets.yaml è¯»å–é…ç½®å¹¶ç”Ÿæˆæ‰€æœ‰åœºæ™¯çš„éšœç¢ç‰©åœ°å›¾
load_and_generate_from_config("config/navigation/navigation_assets.yaml")
```

### ç¤ºä¾‹ 3ï¼šè‡ªå®šä¹‰å‚æ•°

```python
barrier_map = generate_barrier_map_from_usd(
    usd_path="path/to/scene.usd",
    x_bounds=[-10.0, 10.0],
    y_bounds=[-5.0, 5.0],
    resolution=(2048, 1024),  # æ›´é«˜åˆ†è¾¨ç‡
    ignore_prims=[
        "/World/Floor",
        "/World/Ground",
        "/World/Robot",
        "/World/Camera"  # å¿½ç•¥ç›¸æœº
    ],
    output_path="output/barrier_map.png"
)
```

## âš™ï¸ é…ç½®å‚æ•°è¯´æ˜

### åˆ†è¾¨ç‡é€‰æ‹©

- **ä½åˆ†è¾¨ç‡ (512, 256)**ï¼šå¿«é€Ÿç”Ÿæˆï¼Œä½†ç²¾åº¦è¾ƒä½
- **ä¸­ç­‰åˆ†è¾¨ç‡ (1024, 512)**ï¼šå¹³è¡¡ç²¾åº¦å’Œæ€§èƒ½ï¼ˆæ¨èï¼‰
- **é«˜åˆ†è¾¨ç‡ (2048, 1024)**ï¼šé«˜ç²¾åº¦ï¼Œä½†ç”Ÿæˆæ—¶é—´è¾ƒé•¿

### è¾¹ç•Œè®¾ç½®

è¾¹ç•Œåº”è¯¥åŒ¹é…åœºæ™¯çš„å®é™…å¤§å°ï¼š
- å¯ä»¥é€šè¿‡åœºæ™¯ç¼–è¾‘å™¨æŸ¥çœ‹åœºæ™¯è¾¹ç•Œ
- æˆ–ä½¿ç”¨è‡ªåŠ¨æ£€æµ‹åŠŸèƒ½ï¼ˆåœ¨å®Œæ•´ç‰ˆå·¥å…·ä¸­ï¼‰

### å¿½ç•¥ Prim

å»ºè®®å¿½ç•¥ä»¥ä¸‹ primï¼š
- `/World/Floor` - åœ°æ¿
- `/World/Ground` - åœ°é¢
- `/World/Robot` - æœºå™¨äººï¼ˆå¦‚æœåœºæ™¯ä¸­åŒ…å«ï¼‰
- `/World/Light` - å…‰æº
- `/World/Camera` - ç›¸æœº

## ğŸ”§ é«˜çº§ç”¨æ³•

### æ–¹æ³• 1ï¼šä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·

å®Œæ•´ç‰ˆæœ¬æ”¯æŒå‘½ä»¤è¡Œå‚æ•°ï¼š

```bash
python utils/generate_barrier_map.py \
    --usd_path assets/navigation_lab/navigation_lab_01/lab.usd \
    --output assets/navigation/barrier/lab_1.png \
    --x_bounds -7.925 9.175 \
    --y_bounds -1.525 4.175 \
    --resolution 1024 512 \
    --method prims \
    --ignore_prims /World/Floor /World/Robot
```

### æ–¹æ³• 2ï¼šä½¿ç”¨å…¶ä»–ç”Ÿæˆæ–¹æ³•

å®Œæ•´ç‰ˆæœ¬æ”¯æŒä¸‰ç§æ–¹æ³•ï¼š
- `prims`ï¼ˆæ¨èï¼‰ï¼šé€šè¿‡éå† prim ç”Ÿæˆ
- `raycast`ï¼šä½¿ç”¨å°„çº¿æŠ•å°„
- `camera`ï¼šä½¿ç”¨ä¿¯è§†ç›¸æœº

## ğŸ“Š è¾“å‡ºè¯´æ˜

ç”Ÿæˆçš„éšœç¢ç‰©åœ°å›¾æ˜¯é»‘ç™½ PNG å›¾åƒï¼š
- **ç™½è‰²åŒºåŸŸ**ï¼šæœºå™¨äººå¯ä»¥é€šè¡Œçš„è‡ªç”±ç©ºé—´
- **é»‘è‰²åŒºåŸŸ**ï¼šéšœç¢ç‰©ï¼Œæœºå™¨äººä¸èƒ½é€šè¡Œ

å¯ä»¥ç›´æ¥ç”¨äºè·¯å¾„è§„åˆ’ï¼š
```python
from utils.a_star import load_grid

grid, W, H = load_grid("assets/navigation/barrier/lab_1.png")
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¡®ä¿åœºæ™¯å·²åŠ è½½**ï¼šåœ¨è°ƒç”¨ç”Ÿæˆå‡½æ•°å‰ï¼Œç¡®ä¿ USD åœºæ™¯å·²ç»åŠ è½½åˆ° stage
2. **è¾¹ç•Œè®¾ç½®**ï¼šè¾¹ç•Œå¿…é¡»å‡†ç¡®åŒ¹é…åœºæ™¯å¤§å°ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´åæ ‡è½¬æ¢é”™è¯¯
3. **å¿½ç•¥åœ°æ¿**ï¼šé€šå¸¸éœ€è¦å¿½ç•¥åœ°æ¿ primï¼Œå¦åˆ™æ•´ä¸ªåœºæ™¯éƒ½æ˜¯éšœç¢ç‰©
4. **åˆ†è¾¨ç‡**ï¼šåˆ†è¾¨ç‡è¶Šé«˜ï¼Œç”Ÿæˆçš„å›¾åƒè¶Šç²¾ç¡®ï¼Œä½†å¤„ç†æ—¶é—´ä¹Ÿè¶Šé•¿

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šæ•´ä¸ªå›¾åƒéƒ½æ˜¯é»‘è‰²

**åŸå› **ï¼šå¯èƒ½æ²¡æœ‰å¿½ç•¥åœ°æ¿æˆ–åœ°é¢ prim

**è§£å†³**ï¼šæ·»åŠ  `ignore_prims=["/World/Floor", "/World/Ground"]`

### é—®é¢˜ 2ï¼šæŸäº›éšœç¢ç‰©æ²¡æœ‰è¢«æ ‡è®°

**åŸå› **ï¼šå¯èƒ½è¿™äº› prim ä¸åœ¨éå†èŒƒå›´å†…

**è§£å†³**ï¼š
- æ£€æŸ¥ prim è·¯å¾„æ˜¯å¦æ­£ç¡®
- ç¡®ä¿ prim æ˜¯å‡ ä½•ä½“ç±»å‹
- æ£€æŸ¥è¾¹ç•Œè®¾ç½®æ˜¯å¦åŒ…å«è¿™äº›éšœç¢ç‰©

### é—®é¢˜ 3ï¼šåæ ‡è½¬æ¢é”™è¯¯

**åŸå› **ï¼šè¾¹ç•Œè®¾ç½®ä¸æ­£ç¡®

**è§£å†³**ï¼š
- æ£€æŸ¥ `x_bounds` å’Œ `y_bounds` æ˜¯å¦åŒ¹é…åœºæ™¯
- å¯ä»¥ä½¿ç”¨åœºæ™¯ç¼–è¾‘å™¨æŸ¥çœ‹å®é™…è¾¹ç•Œ

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `utils/generate_barrier_map_simple.py` - ç®€åŒ–ç‰ˆå·¥å…·ï¼ˆæ¨èï¼‰
- `utils/generate_barrier_map.py` - å®Œæ•´ç‰ˆå·¥å…·ï¼ˆæ”¯æŒå¤šç§æ–¹æ³•ï¼‰
- `generate_barrier_map_example.py` - ä½¿ç”¨ç¤ºä¾‹
- `utils/a_star.py` - è·¯å¾„è§„åˆ’å·¥å…·ï¼ˆä½¿ç”¨éšœç¢ç‰©åœ°å›¾ï¼‰

## ğŸ’¡ æç¤º

1. é¦–æ¬¡ç”Ÿæˆæ—¶ï¼Œå»ºè®®å…ˆç”¨å°åˆ†è¾¨ç‡æµ‹è¯•
2. ç”ŸæˆåæŸ¥çœ‹å›¾åƒï¼Œç¡®è®¤éšœç¢ç‰©æ ‡è®°æ­£ç¡®
3. å¯ä»¥æ‰‹åŠ¨ç¼–è¾‘ç”Ÿæˆçš„å›¾åƒæ¥ä¿®å¤å°é”™è¯¯
4. ä¿å­˜åŸå§‹ USD æ–‡ä»¶ï¼Œæ–¹ä¾¿åç»­é‡æ–°ç”Ÿæˆ

